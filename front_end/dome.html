<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>大屏</title>
        <script src="./js/vue.js"></script>
        <script src="./js/axios.min.js"></script>
        <script src="./js/echarts.min.js"></script>
        <script src="./js/vue-router.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/style.css">
        <link rel="stylesheet" href="./css/index.css">
        <script src="./js/element-ui.js"></script>
    </head>
    <body>
        <div id='app'>
            <div>
                <router-link to='/beijing'><el-button type='primary' @click.native='initbeijing'>北京</el-button></router-link>
            </div>
            <router-view></router-view>
            <div v-if='show'>
                <div id='box-1' style="width:700px; height:325px"></div>
                <div id='box-2' style="width:700px; height:325px"></div>
                <div id='box-3' style="width:700px; height:325px;"></div>
                <div id='box-4' style="width:700px; height:325px;"></div>
            </div>
        </div>
        <script>
            var work_list = ['后端工程师','前端工程师','Java工程师','算法工程师','数据分析师','测试工程师'];
            var company_list = ['华为','腾讯','阿里巴巴','百度'];
            var area_list = ['北京','上海','深圳','杭州'];
            function create_chart(name){
                this.chart = {};
                this.list = [];
                this.name = name; 
            }
            var beijing = {
                template:`
                <div>
                    <div id='bj-box-1' style="width:700px; height:325px"></div>
                    <div id='bj-box-2' style="width:700px; height:325px"></div> 
                </div>`
            };
            var router = new VueRouter({
                routes:[
                    {path: '/beijing',component: beijing}
                ]
            })
            var app = new Vue({
                el:'#app',
                data:{
                   show:true,
                   areadetail:{
                    detail_list:[],
                    beijing:{
                        workchart: new create_chart(work_list),
                        paychart: new create_chart(work_list)
                    },
                    shanghai:{
                        workchart: new create_chart(work_list),
                        paychart: new create_chart(work_list)
                    },
                    shenzhen:{
                        workchart: new create_chart(work_list),
                        paychart: new create_chart(work_list)
                    },
                    hangzhou:{
                        workchart: new create_chart(work_list),
                        paychart: new create_chart(work_list)
                    }
                   },
                   workchart: new create_chart(work_list),
                   paychart: new create_chart(work_list),
                   companychart: new create_chart(company_list),
                   areachart: new create_chart(area_list)
                },
                methods:{
                    setchart:function(chart,id,option){
                        chart = echarts.init(document.getElementById(id));
                        chart.setOption(option);
                    },
                    formatdata:function(j){
                        var list = []
                        for(var i=0;i<4;i++){
                            list.push(this.companychart.list[i][j])
                        }
                        return list
                    },
                    insertdata:function(area,list){
                        // console.log(list);
                        // console.log(list[0]);
                        for(var i=0;i<6;i++){
                            area.workchart.list.push(list[i][0]);
                            area.paychart.list.push(list[i][1]);
                        }
                    },
                    create_workchart:function(obj){
                        var option =  {
                                    tooltip: {
                                        trigger: 'item'
                                    },
                                    legend: {
                                        orient: 'vertical',
                                        left: 'left',
                                    },
                                    series: [
                                        {
                                            name: '岗位数量',
                                            type: 'pie',
                                            radius: ['40%', '70%'],
                                            avoidLabelOverlap: false,
                                            label: {
                                                show: false,
                                                position: 'center'
                                            },
                                            emphasis: {
                                                label: {
                                                    show: false,
                                                }
                                            },
                                            labelLine: {
                                                show: false
                                            },
                                            data: [
                                                {value: obj.list[0], name: obj.name[0]},
                                                {value: obj.list[1], name: obj.name[1]},
                                                {value: obj.list[2], name: obj.name[2]},
                                                {value: obj.list[3], name: obj.name[3]},
                                                {value: obj.list[4], name: obj.name[4]},
                                                {value: obj.list[5], name: obj.name[5]}
                                            ]
                                        }
                                    ]
                        };
                        return option;
                    },
                    create_paychart:function(obj){
                        var option = {
                            xAxis: {
                                type: 'category',
                                data: obj.name
                            },
                            yAxis: {
                                type: 'value'
                            },
                            tooltip:{
                                trigger:'axis'
                            },
                            series: [{
                                data: obj.list,
                                type: 'bar'
                            }]
                        };
                        return option;
                    },
                    create_companychart:function(obj){
                        var option = {
                                tooltip: {
                                    trigger: 'axis',
                                    axisPointer: {            
                                        type: 'shadow'        
                                    }
                                },
                                legend: {
                                    data: work_list
                                },
                                grid: {
                                    left: '3%',
                                    right: '4%',
                                    bottom: '3%',
                                    containLabel: true
                                },
                                xAxis: {
                                    type: 'value'
                                },
                                yAxis: {
                                    type: 'category',
                                    data: obj.name
                                },
                                series: [
                                    {
                                        name: '后端工程师',
                                        type: 'bar',
                                        stack: 'total',
                                        label: {
                                            show: true
                                        },
                                        emphasis: {
                                            focus: 'series'
                                        },
                                        data: this.formatdata(0)
                                    },
                                    {
                                        name: '前端工程师',
                                        type: 'bar',
                                        stack: 'total',
                                        label: {
                                            show: true
                                        },
                                        emphasis: {
                                            focus: 'series'
                                        },
                                        data: this.formatdata(1)
                                    },
                                    {
                                        name: 'Java工程师',
                                        type: 'bar',
                                        stack: 'total',
                                        label: {
                                            show: true
                                        },
                                        emphasis: {
                                            focus: 'series'
                                        },
                                        data: this.formatdata(2)
                                    },
                                    {
                                        name: '算法工程师',
                                        type: 'bar',
                                        stack: 'total',
                                        label: {
                                            show: true
                                        },
                                        emphasis: {
                                            focus: 'series'
                                        },
                                        data: this.formatdata(3)
                                    },
                                    {
                                        name: '数据分析师',
                                        type: 'bar',
                                        stack: 'total',
                                        label: {
                                            show: true
                                        },
                                        emphasis: {
                                            focus: 'series'
                                        },
                                        data: this.formatdata(4)
                                    },
                                    {
                                        name: '测试工程师',
                                        type: 'bar',
                                        stack: 'total',
                                        label: {
                                            show: true
                                        },
                                        emphasis: {
                                            focus: 'series'
                                        },
                                        data: this.formatdata(5)
                                    }
                                    
                                ]
                        };
                        return option;
                    },
                    create_areachart:function(obj){
                        var option = {
                                dataset: [{
                                    dimensions: ['city','num'],
                                    source: [
                                        [obj.name[0],obj.list[0]],
                                        [obj.name[1],obj.list[1]],
                                        [obj.name[2],obj.list[2]],
                                        [obj.name[3],obj.list[3]]
                                    ]
                                }, {
                                    transform: {
                                        type: 'sort',
                                        config: { dimension: 'num', order: 'desc' }
                                    }
                                }],
                                xAxis: {
                                    type: 'category',
                                    // axisLabel: { interval: 0, rotate: 30 },
                                },
                                yAxis: {},
                                tooltip:{
                                    trigger:'axis'
                                },
                                series: {
                                    type: 'bar',
                                    encode: { x: 'city', y: 'num' },
                                    datasetIndex: 1
                                }
                        };
                        return option;
                    },
                    initbeijing:function(){
                        this.show = false;
                        var workoption = this.create_workchart(this.areadetail.beijing.workchart);
                        var payoption = this.create_paychart(this.areadetail.beijing.paychart);
                        setTimeout(() => {
                            // console.log(this.areadetail.beijing.paychart.name);
                            // console.log(this.areadetail.beijing.paychart.list);
                            this.setchart(this.areadetail.beijing.workchart.chart,'bj-box-1',workoption);
                            this.setchart(this.areadetail.beijing.paychart.chart,'bj-box-2',payoption);
                        },1000)
                    },
                    initecharts:function(){
                        var work_pay_option = this.create_paychart(this.paychart);
                        var work_num_option = this.create_workchart(this.workchart);
                        var company_option = this.create_companychart(this.companychart);
                        var area_option = this.create_areachart(this.areachart);
                        this.setchart(this.areachart.chart,'box-4',area_option);
                        this.setchart(this.companychart.chart,'box-3',company_option);    
                        this.setchart(this.paychart.chart,'box-2',work_pay_option);
                        this.setchart(this.workchart.chart,'box-1',work_num_option);
                    },
                    getdata:function(){
                        var that = this;
                        axios.post('http://127.0.0.1:5000/getdata')
                        .then(function(response){
                            console.log(response);
                            for(var i=0;i<6;i++){
                                that.workchart.list.push(response.data.work_num[i]);
                                that.paychart.list.push(response.data.work_pay[i]);
                                if(i<4){
                                    that.companychart.list.push(response.data.company_data[i]);
                                }
                                if(i<4){
                                    that.areachart.list.push(response.data.area_data[i]);
                                }
                            }
                            for(var j=0;j<4;j++){
                                that.areadetail.detail_list.push(response.data.area_detail[j]);
                            }
                            // console.log(response.data.area_detail[0]);
                            that.insertdata(that.areadetail.beijing,response.data.area_detail[0]);
                            that.insertdata(that.areadetail.shanghai,response.data.area_detail[1]);
                            that.insertdata(that.areadetail.shenzhen,response.data.area_detail[2]);
                            that.insertdata(that.areadetail.hangzhou,response.data.area_detail[3]);
                            
                        },function(err){
                            console.log(err);
                        })
                    }
                },
                mounted:function(){
                    this.getdata();
                    // this.initdetail();
                    // console.log(this.areadetail.detail_list);
                    // console.log(this.workdata);
                    setTimeout(() => {
                        this.initecharts();
                    },1000);
                },
                router
            })
        </script>
    </body>
</html>